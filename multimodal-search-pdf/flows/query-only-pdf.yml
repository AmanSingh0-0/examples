jtype: Flow  # this is a flow only for querying text data
version: '1'
with:
  workspace: './workspace'
  read_only: true
  py_module:
    - pods/executors.py
pods:
  - name: craft
    uses:
      jtype: PDFCrafter
  - name: segmentText
    uses:
      jtype: TextSegmenter
  - name: textEncoder
    uses:
      jtype: TextEncoder
  - name: textChunkIndexer
    uses:
      jtype: DocVectorIndexer
      with:
        index_file_name: 'text.json'
  - name: imagePreprocessor
    uses:
      jtype: ImagePreprocessor
    needs: craft
  - name: imageEncoder                      # encode the image into embeddings
    uses:
      jtype: ImageTorchEncoder
  - name: imageChunkIndexer                  # index the images, note that here we will index on chunks level
    uses:
      jtype: DocVectorIndexer
      with:
        index_file_name: 'image.json'
  - name: weightedModalityRanker
    uses:
      jtype: WeightedModalityRanker
    needs: [ textChunkIndexer, imageChunkIndexer]
  - name: keyValueIndexer
    uses:
      jtype: KeyValueIndexer
    needs: weightedModalityRanker