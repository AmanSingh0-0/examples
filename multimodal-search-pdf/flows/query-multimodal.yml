jtype: Flow  # this is a flow only for querying text data
version: '1'
with:
  workspace: './workspace'
  read_only: true
  port_expose: '56708'
  py_module:
    - pods/executors.py
pods:
  - name: segmentPDF
    uses:
      jtype: PDFSegmenter
    needs: gateway
  - name: segmentText
    uses:
      jtype: TextSegmenter
    needs: segmentPDF
  - name: craftImage
    uses:
      jtype: ImageCrafter
    needs: segmentText
  - name: textEncoder
    uses:
      jtype: TextEncoder
    needs: craftImage
  - name: textChunkIndexer
    uses:
      jtype: DocVectorIndexer
      with:
        index_file_name: 'text.json'
    needs: textEncoder
  - name: imageEncoder                      # encode the image into embeddings
    uses:
      jtype: ImageTorchEncoder
    needs: craftImage
  - name: imageChunkIndexer                  # index the images, note that here we will index on chunks level
    uses:
      jtype: DocVectorIndexer
      with:
        index_file_name: 'image.json'
    needs: imageEncoder
  - name: weightedModalityRanker
    uses:
      jtype: WeightedModalityRanker
    needs: [ textChunkIndexer, imageChunkIndexer]
  - name: keyValueIndexer
    uses:
      jtype: KeyValueIndexer
    needs: weightedModalityRanker