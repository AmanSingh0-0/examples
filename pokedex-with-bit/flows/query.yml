!Flow
version: '1'
with:
  workspace: "workspace"
  py_modules:
    - executors.py
  read_only: true  # better add this in the query time
  rest_api: true
  port_expose: $JINA_PORT
executors:
  - name: crafter
    uses:
      jtype: ImageCrafter
      with:
        target_size: 96
        img_mean: [ 0.485, 0.456, 0.406 ]
        img_std: [ 0.229, 0.224, 0.225 ]
  - name: encoder
    uses:
      jtype: BigTransferEncoder
  - name: vec_idx
    uses:
      jtype: DocVectorIndexer
      with:
        index_file_name: "image.json"
  - name: doc_idx
    uses:
      jtype: KeyValueIndexer
    needs: [gateway]
  - name: join_all
    #uses: _merge
    needs: [doc_idx, vec_idx]
    read_only: true
